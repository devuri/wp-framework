import{_ as i,c as e,o as a,a4 as t}from"./chunks/framework.CPs9Ukbn.js";const f=JSON.parse('{"title":"Multi-Tenant Application","description":"","frontmatter":{},"headers":[],"relativePath":"multi-tenant.md","filePath":"multi-tenant.md"}'),n={name:"multi-tenant.md"},s=t(`<h1 id="multi-tenant-application" tabindex="-1">Multi-Tenant Application <a class="header-anchor" href="#multi-tenant-application" aria-label="Permalink to &quot;Multi-Tenant Application&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>This document provides a guide to the architecture and operational flow of our Multi-Tenant Application. The framework is designed to support multiple tenants (websites), each with its unique configuration and customization capabilities, on a shared infrastructure.</p><h3 id="step-1-backup-your-site" tabindex="-1">Step 1: Backup Your Site <a class="header-anchor" href="#step-1-backup-your-site" aria-label="Permalink to &quot;Step 1: Backup Your Site&quot;">​</a></h3><p>Before making any changes, ensure you have a full backup of your WordPress files and database.</p><p>Install and activate the <a href="#">Tenancy plugin</a>, this will create the required database tables and admin area on the main site ( referred to as the Landlord site ).</p><h3 id="enabling-multi-tenancy-configuration" tabindex="-1">Enabling Multi-Tenancy Configuration <a class="header-anchor" href="#enabling-multi-tenancy-configuration" aria-label="Permalink to &quot;Enabling Multi-Tenancy Configuration&quot;">​</a></h3><p>To activate the multi-tenant functionality within your setup, follow these steps:</p><ol><li><p><strong>Access Configuration Files:</strong></p><ul><li>Ensure you&#39;re in your application&#39;s root directory. Look for the <code>configs</code> directory. If it doesn&#39;t exist, you&#39;ll need to create it to store your configuration files.</li></ul></li><li><p><strong>Modify Tenancy Configuration:</strong></p><ul><li>In the <code>configs</code> directory, locate the <code>tenancy.php</code> file. If it&#39;s not present, you should create it. This file will hold your tenancy-related configurations.</li><li>Here&#39;s an example of default values you might find or include in <code>tenancy.php</code>:<div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Default settings in tenancy.php</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">define</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ALLOW_MULTITENANT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Flag to enable/disable multi-tenancy</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">define</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;LANDLORD_UUID&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Identifier for the landlord or primary tenant</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">define</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;REQUIRE_TENANT_CONFIG&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Whether tenant-specific config is mandatory</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">define</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TENANCY_WEB_ROOT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;public&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Root directory for web assets</span></span></code></pre></div></li></ul></li><li><p><strong>Activate Multi-Tenant Mode:</strong></p><ul><li>To enable the multi-tenant, you need to change the <code>ALLOW_MULTITENANT</code> setting from <code>false</code> to <code>true</code>. This action activates the multi-tenancy capabilities of your application, allowing it to handle requests for multiple tenants.<div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">define</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ALLOW_MULTITENANT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Enable multi-tenancy</span></span></code></pre></div></li></ul></li><li><p><strong>Set the Landlord UUID:</strong></p><ul><li>Additionally, you&#39;ll need to specify the UUID for the landlord (main tenant). This unique identifier is typically provided at the bottom of the plugin&#39;s main page after you&#39;ve enabled the Tenancy Manager Plugin. If you have this information, update the following line accordingly:</li></ul><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">define</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;LANDLORD_UUID&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;your-landlord-uuid-here&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Replace <code>&#39;your-landlord-uuid-here&#39;</code> with your actual landlord UUID.</p></li></ol><h3 id="step-3-configuring-landlord-environment-settings" tabindex="-1">Step 3: Configuring Landlord Environment Settings <a class="header-anchor" href="#step-3-configuring-landlord-environment-settings" aria-label="Permalink to &quot;Step 3: Configuring Landlord Environment Settings&quot;">​</a></h3><p>To properly set up the Landlord environment for your multi-tenant application installation, follow these steps to ensure a proper database connection:</p><ol><li><p><strong>Backup Your Existing Environment File</strong>: Before making any changes, it&#39;s crucial to back up your current <code>.env</code> file.</p></li><li><p><strong>Create a New <code>.env</code> File</strong>: In the root directory of application installation, create a new <code>.env</code> file. This file will store the environment-specific configurations for the Landlord database (settings in this env file are discarded after initial setup of the Landlord).</p></li><li><p><strong>Configure Landlord Database Settings</strong>: Inside the newly created <code>.env</code> file, input the following configuration settings. These settings should match those of the main site (also referred to as the Landlord site) where the Tenancy plugin is installed. Adjust the values to reflect your specific Landlord database credentials:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Landlord Database Configuration</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LANDLORD_DB_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # The name of your Landlord database</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LANDLORD_DB_USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # The username for your Landlord database access</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LANDLORD_DB_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # The password for your Landlord database access</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LANDLORD_DB_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">localhost</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # The hostname for your Landlord database server, typically &#39;localhost&#39;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LANDLORD_DB_PREFIX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">wp_lo6j2n6v_</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # The prefix for your Landlord database tables, adjust as needed</span></span></code></pre></div></li></ol><h2 id="domain-and-tenant-mapping" tabindex="-1">Domain and Tenant Mapping <a class="header-anchor" href="#domain-and-tenant-mapping" aria-label="Permalink to &quot;Domain and Tenant Mapping&quot;">​</a></h2><ul><li>Tenants are uniquely identified by a Universal Unique Identifier (UUID).</li><li>The mapping between a tenant&#39;s domain (derived from HTTP_HOST) and its UUID is crucial.</li></ul><h2 id="installation-steps" tabindex="-1">Installation Steps <a class="header-anchor" href="#installation-steps" aria-label="Permalink to &quot;Installation Steps&quot;">​</a></h2><blockquote><p><strong>Note</strong>: The uploads directory will be set to <code>/public/app/tenant/a345ea9515c/uploads</code>. Make sure to transfer or replicate your site files to this new directory. This setup uses the <code>tenant_id</code> for isolated file storage per tenant.</p></blockquote><h2 id="configuration-and-environment-files" tabindex="-1">Configuration and Environment Files <a class="header-anchor" href="#configuration-and-environment-files" aria-label="Permalink to &quot;Configuration and Environment Files&quot;">​</a></h2><ul><li>Tenant-specific configuration files are located as follows: <ul><li><code>.env</code>: <code>&quot;path/configs/a345ea9515c/.env&quot;</code></li><li><code>app.php</code>: <code>&quot;path/configs/a345ea9515c/app.php&quot;</code></li><li><code>config.php</code>: <code>&quot;path/configs/a345ea9515c/config.php&quot;</code></li></ul></li></ul><p>The framework supports distinct configurations for each tenant, enabling customized settings per site within a multi-tenant environment:</p><h4 id="locations" tabindex="-1">Locations <a class="header-anchor" href="#locations" aria-label="Permalink to &quot;Locations&quot;">​</a></h4><ul><li><strong>Environment File</strong>: Located at <code>path/configs/{tenant_id}/.env</code>, it stores environment-specific variables.</li><li><strong>PHP Configuration</strong>: Found at <code>path/configs/{tenant_id}/config.php</code>, this file contains PHP configuration file overrides.</li><li><strong>Framework Options</strong>: Found at <code>path/configs/{tenant_id}/app.php</code>, this file contains an array of options specific to the tenant.</li></ul><h4 id="loading-mechanism" tabindex="-1">Loading Mechanism <a class="header-anchor" href="#loading-mechanism" aria-label="Permalink to &quot;Loading Mechanism&quot;">​</a></h4><ol><li><strong>Tenant-Specific</strong>: The framework first attempts to load configurations from the tenant&#39;s directory.</li><li><strong>Fallback</strong>: In the absence of tenant-specific files, it defaults to the global <code>config.php</code> or in the case of options <code>app.php</code>.</li><li><strong>Overrides</strong>: Global settings in the default config can be overridden by tenant-specific files for flexibility.</li></ol><p><strong><code>REQUIRE_TENANT_CONFIG</code> Setting:</strong></p><blockquote><p><strong>Note:</strong> The <code>REQUIRE_TENANT_CONFIG</code> constant mandates the presence of tenant-specific configuration options <code>app.php</code>. When enabled (<code>true</code>), it requires that each tenant must have their own configuration file located at <code>config/{tenant_id}/app.php</code>. Conversely, when disabled (<code>false</code>), we can use a global <code>app.php</code> file. The default setting for this constant is <code>false</code>.</p></blockquote><p>This configuration toggles the enforcement of tenant-specific settings within the application. When enabled (<code>true</code>), it requires each tenant to have a dedicated <code>config/{tenant_id}/app.php</code> file, ensuring tailored settings per tenant. In the absence of a tenant-specific file, the application will signal an error, highlighting the necessity for individual configurations. By default, this setting is disabled (<code>false</code>), allowing for a shared <code>app.php</code> configuration across tenants, simplifying setup for environments where distinct tenant configurations are not critical.</p><h4 id="benefits" tabindex="-1">Benefits <a class="header-anchor" href="#benefits" aria-label="Permalink to &quot;Benefits&quot;">​</a></h4><ul><li>Enables per-tenant customizations.</li><li>Provides a fallback to ensure system stability.</li><li>Allows global settings to be overridden at the tenant level.</li></ul><p>This approach ensures a balance between customization for individual tenants and consistency across the framework.</p><h2 id="tenant-specific-variables" tabindex="-1">Tenant-Specific Variables <a class="header-anchor" href="#tenant-specific-variables" aria-label="Permalink to &quot;Tenant-Specific Variables&quot;">​</a></h2><ul><li>Each tenant&#39;s <code>.env</code> file can contain specific environment variables, such as: <ul><li><code>APP_TENANT_ID=a345ea9515c</code></li><li>Optionally, <code>APP_TENANT_SECRET</code> for additional security.</li></ul></li></ul><h2 id="customizing-tenant-configurations" tabindex="-1">Customizing Tenant Configurations <a class="header-anchor" href="#customizing-tenant-configurations" aria-label="Permalink to &quot;Customizing Tenant Configurations&quot;">​</a></h2><ul><li>Utilize <code>env(&#39;APP_TENANT_ID&#39;)</code> within the application to access and modify configurations dynamically for each tenant. It is also set as <code>APP_TENANT_ID</code> constant during initialization steps.</li></ul><h2 id="isolated-uploads-directory" tabindex="-1">Isolated Uploads Directory <a class="header-anchor" href="#isolated-uploads-directory" aria-label="Permalink to &quot;Isolated Uploads Directory&quot;">​</a></h2><ul><li>Media files for each tenant are stored in a separate directory, typically structured as <code>wp-content/tenant/{tenant_id}/uploads</code>. Depending on the framework&#39;s setup, the default path might vary, but it generally follows the format <code>app/tenant/{tenant_id}/uploads</code>.</li></ul><h2 id="shared-resources" tabindex="-1">Shared Resources <a class="header-anchor" href="#shared-resources" aria-label="Permalink to &quot;Shared Resources&quot;">​</a></h2><ul><li>Plugins and Themes are shared across tenants, optimizing resources and simplifying management.</li><li>The shared resources&#39; paths are defined in the <code>app.php</code> file and the framework&#39;s <code>composer.json</code>.</li></ul><h2 id="plugin-and-theme-management" tabindex="-1">Plugin and Theme Management <a class="header-anchor" href="#plugin-and-theme-management" aria-label="Permalink to &quot;Plugin and Theme Management&quot;">​</a></h2><ul><li>An MU (Must-Use) plugin controls the availability of specific plugins and themes for each tenant.</li><li>The <code>IS_MULTITENANT</code> constant aids in configuring resource availability and is particularly useful during tenant migrations or when converting a tenant to a standalone installation.</li></ul><h2 id="suitability-for-multi-tenant-architecture" tabindex="-1">Suitability for Multi-Tenant Architecture <a class="header-anchor" href="#suitability-for-multi-tenant-architecture" aria-label="Permalink to &quot;Suitability for Multi-Tenant Architecture&quot;">​</a></h2><p>While the Multi-Tenant Application offers efficient resource sharing and management, it&#39;s crucial to assess its suitability based on your specific needs:</p><h3 id="considerations" tabindex="-1">Considerations <a class="header-anchor" href="#considerations" aria-label="Permalink to &quot;Considerations&quot;">​</a></h3><ul><li><strong>Isolation</strong>: Full isolation might require alternative solutions if stringent separation is needed.</li><li><strong>Performance</strong>: High-demand applications may benefit from dedicated resources.</li><li><strong>Security</strong>: Additional measures might be necessary to meet specific security standards.</li><li><strong>Customization</strong>: Extensive per-tenant customizations could complicate the multi-tenant model.</li></ul><h3 id="evaluation" tabindex="-1">Evaluation <a class="header-anchor" href="#evaluation" aria-label="Permalink to &quot;Evaluation&quot;">​</a></h3><div class="caution custom-block github-alert"><p class="custom-block-title">CAUTION</p><p></p><p>Thoroughly evaluate your use case before adopting a multi-tenant architecture. For certain scenarios, a single-tenant or dedicated solution might be more appropriate.</p></div><p>The Multi-Tenant Application excels in scenarios prioritizing efficient management and shared infrastructure. It&#39;s an ideal choice if these factors align with your project goals.</p><blockquote><p>Every project is unique, so it&#39;s important to choose an architecture that fits your specific requirements and constraints.</p></blockquote><p><strong>Note: This documentation is continually evolving, and we welcome community contributions and feedback. If you have suggestions or notice areas needing improvement, please contribute via pull requests or contact our development team. Your input is invaluable in refining this guide.</strong></p>`,48),o=[s];function l(r,d,c,h,p,u){return a(),e("div",null,o)}const k=i(n,[["render",l]]);export{f as __pageData,k as default};
